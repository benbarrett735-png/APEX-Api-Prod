# Environment Variables - API

**Generated:** 2025-10-16  
**Source:** Scanned from `src/` directory  
**Total Count:** 31 variables

---

## Complete List (Alphabetical)

All environment variables referenced in the API codebase:

```
ADI_ANALYZE_OVERLOAD
ADI_ANALYZE_PATH
ADI_ANALYZE_URL
ADI_API_VERSION
ADI_MODEL_ID
ADI_RESULT_PATH
ADI_RESULT_URL
APIM_HOST
APIM_OPERATION
APIM_SUBSCRIPTION_KEY
API_URL
AZURE_STORAGE_CONNECTION_STRING
CHAT_MODEL_MINI
CHAT_MODEL_STRONG
CHAT_PATH_MINI
CHAT_PATH_STRONG
CHAT_URL_MINI
CHAT_URL_STRONG
CORS_ORIGIN
DATABASE_URL
HTTP_TIMEOUT_MS
MODEL
OIDC_AUDIENCE
OIDC_AUTHORITY
OIDC_CLIENT_ID
OPENAI_API_KEY
OPEN_AI_KEY
PGSSL
POLL_INTERVAL_MS
POLL_MAX_SECONDS
PORT
```

---

## Categorized by Service

### âœ… Already Configured (App Runner)
These are already set in the current deployment:

- `PORT` - Server port (3000)
- `OIDC_AUTHORITY` - Cognito authority URL
- `OIDC_CLIENT_ID` - Cognito client ID
- `OIDC_AUDIENCE` - Token audience (defaults to CLIENT_ID)
- `CORS_ORIGIN` - Portal origin for CORS

**Status:** Working âœ…

---

### ðŸ”´ Critical - Required for Basic Functionality

#### Database
- `DATABASE_URL` - PostgreSQL connection string
- `PGSSL` - SSL mode for PostgreSQL (true/false)

#### OpenAI (for chat routes)
- `OPENAI_API_KEY` - Primary OpenAI key
- `OPEN_AI_KEY` - Alternate/legacy OpenAI key (check if duplicate)

**Priority:** HIGH - needed for `/chat/normal` to work

---

### ðŸŸ¡ Feature-Specific - Add When Enabling Routes

#### ADI Service (Document Analysis)
- `ADI_ANALYZE_OVERLOAD` - Overload handling config
- `ADI_ANALYZE_PATH` - API path for analysis
- `ADI_ANALYZE_URL` - Full URL for analysis endpoint
- `ADI_API_VERSION` - API version
- `ADI_MODEL_ID` - Model identifier
- `ADI_RESULT_PATH` - Result retrieval path
- `ADI_RESULT_URL` - Full URL for results

**Routes:** `/adi/*`  
**Priority:** MEDIUM - only needed when `/adi` routes enabled

#### Azure API Management
- `APIM_HOST` - Azure APIM hostname
- `APIM_OPERATION` - Operation identifier
- `APIM_SUBSCRIPTION_KEY` - APIM subscription key
- `API_URL` - Base API URL (may be redundant)

**Routes:** Multiple (ADI, chat via APIM)  
**Priority:** HIGH - if using APIM gateway

#### Chat Models
- `CHAT_MODEL_MINI` - Model name for mini/fast chat
- `CHAT_MODEL_STRONG` - Model name for strong/smart chat
- `CHAT_PATH_MINI` - API path for mini model
- `CHAT_PATH_STRONG` - API path for strong model
- `CHAT_URL_MINI` - Full URL for mini model
- `CHAT_URL_STRONG` - Full URL for strong model
- `MODEL` - Default model name

**Routes:** `/chat/normal`, `/chat/agent`  
**Priority:** HIGH - needed for chat functionality

#### Azure Storage
- `AZURE_STORAGE_CONNECTION_STRING` - Azure Blob Storage connection

**Routes:** File uploads, report exports  
**Priority:** MEDIUM - only needed for file operations

#### Performance/Polling
- `HTTP_TIMEOUT_MS` - HTTP request timeout (milliseconds)
- `POLL_INTERVAL_MS` - Polling interval for async operations
- `POLL_MAX_SECONDS` - Maximum polling duration

**Routes:** ADI, async operations  
**Priority:** LOW - has defaults in code

---

## Step 5.2 Preparation - Minimum Required Set

To get `/chat/normal` working, we need AT MINIMUM:

### Critical (Must Have)
```bash
DATABASE_URL=postgres://user:pass@host:port/dbname?sslmode=require
OPENAI_API_KEY=sk-...
```

### Auth (Already Set)
```bash
PORT=3000
OIDC_AUTHORITY=https://cognito-idp.eu-west-1.amazonaws.com/eu-west-1_JiQF0xM04
OIDC_CLIENT_ID=6mvn1gc775h8ibei5phrkk60l1
CORS_ORIGIN=https://staging.d2umjimd2ilqq7.amplifyapp.com
```

### Optional but Recommended
```bash
PGSSL=true
HTTP_TIMEOUT_MS=30000
CHAT_MODEL_MINI=gpt-3.5-turbo
CHAT_MODEL_STRONG=gpt-4
```

**Total Minimum:** 2 new variables (DATABASE_URL, OPENAI_API_KEY)

---

## Next Steps (Step 5.2)

1. Retrieve from AWS Secrets Manager:
   - Database connection string (staging)
   - OpenAI API key

2. Add to App Runner environment variables

3. Redeploy (automatic when env vars change)

4. Test database connectivity

Then Step 5.3: Re-enable chat routes in tsconfig + mount router

---

## Notes

- `OPEN_AI_KEY` vs `OPENAI_API_KEY` - Check if these are duplicates or different keys
- `API_URL` - May be redundant with internal routing
- `APIM_*` variables - Only needed if routing through Azure APIM gateway
- ADI variables - Can be added later when document analysis features are tested

---

**Generated by:** `grep -Rno "process\.env\.[A-Z0-9_]\+" src | sed -E 's/.*process\.env\.([A-Z0-9_]+).*/\1/' | sort -u`

